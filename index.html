<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Jharkhand Tourism VR Experience ‚Äî Fixed VR</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Georgia", serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      overflow: hidden;
    }
    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 999;
      background: rgba(30, 60, 114, 0.9);
      color: white;
      padding: 15px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      width: 220px;
    }
    .title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #ffd700;
      text-align: center;
    }
    button {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 6px 0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.25s ease;
    }
    button:hover { transform: scale(1.05); }
    .vr-button { background: linear-gradient(135deg, #4caf50, #45a049); }
    .back-button { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
    @media (max-width: 600px) {
      .controls { width: 90%; left: 50%; transform: translateX(-50%); }
    }
  </style>
</head>
<body>
  <div class="controls">
    <div class="title">üó∫Ô∏è Jharkhand VR Tour</div>
    <button class="vr-button" id="enter-vr-btn">ü•Ω Enter VR</button>
    <button class="back-button" id="back-btn" style="display:none">üó∫Ô∏è Back to Map</button>
    <button id="info-btn">‚ÑπÔ∏è Info</button>
  </div>

  <a-scene embedded vr-mode-ui="enabled: true" style="height:100vh; width:100vw;">
    <a-assets>
      <img id="map-img" src="jharkhand-map.jpg" crossorigin="anonymous">
      <img id="hundru-img" src="hundru-falls.jpg" crossorigin="anonymous">
      <img id="baidyanath-img" src="baidyanath-temple-360.jpg" crossorigin="anonymous">
      <img id="netarhat-img" src="netarhat-sunset-360.jpg" crossorigin="anonymous">
      <img id="betla-img" src="betla-national-park-360.jpg" crossorigin="anonymous">
      <img id="patratu-img" src="patratu-valley-360.jpg" crossorigin="anonymous">
      <img id="tagore-img" src="tagore-hill-360.jpg" crossorigin="anonymous">
    </a-assets>

    <!-- Map view -->
    <a-entity id="map-view">
      <a-plane position="0 0 -5" width="10" height="7" material="src: #map-img" visible="true"></a-plane>
      <a-text position="0 4 -4.8" value="JHARKHAND TOURISM MAP" color="#FFD700" align="center" width="30" scale="0.8 0.8 0.8"></a-text>
    </a-entity>

    <!-- Markers -->
    <a-entity id="markers">
      <a-sphere position="0 -0.5 -4.5" radius="0.1" color="#FF0000" data-location="hundru" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
      <a-sphere position="2 1 -4.5" radius="0.1" color="#FF0000" data-location="baidyanath" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
      <a-sphere position="-2.5 0.2 -4.5" radius="0.1" color="#FF0000" data-location="netarhat" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
      <a-sphere position="-2.3 0.8 -4.5" radius="0.1" color="#FF0000" data-location="betla" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
      <a-sphere position="0.5 0 -4.5" radius="0.1" color="#FF0000" data-location="patratu" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
      <a-sphere position="-0.5 -0.8 -4.5" radius="0.1" color="#FF0000" data-location="tagore" class="marker" animation="property: scale; to: 1.2 1.2 1.2; loop: true; dir: alternate"></a-sphere>
    </a-entity>

    <!-- Sky and camera -->
    <a-sky id="sky" color="#1a1a2e"></a-sky>
    <a-camera position="0 1.6 0">
      <a-cursor color="white" raycaster="objects: .marker"></a-cursor>
    </a-camera>

    <a-light type="ambient" color="#ffffff" intensity="0.9"></a-light>
  </a-scene>

  <script>
    // data
    const locations = {
      hundru: { title: "Hundru Falls", src: "#hundru-img", info: "Spectacular 320-foot waterfall on the Subarnarekha River." },
      baidyanath: { title: "Baidyanath Temple", src: "#baidyanath-img", info: "Sacred Jyotirlinga temple, one of the holiest Shiva shrines." },
      netarhat: { title: "Netarhat Hill Station", src: "#netarhat-img", info: "Queen of Chotanagpur, known for stunning sunrises." },
      betla: { title: "Betla National Park", src: "#betla-img", info: "Wildlife sanctuary with tigers, elephants, and scenic forests." },
      patratu: { title: "Patratu Valley", src: "#patratu-img", info: "Beautiful valley with a dam, boating, and picturesque views." },
      tagore: { title: "Tagore Hill", src: "#tagore-img", info: "Historic hill named after Rabindranath Tagore with panoramic views." }
    };

    let currentView = "map";
    const sceneEl = document.querySelector('a-scene');
    const sky = document.querySelector('#sky');

    // marker click behavior
    document.querySelectorAll('.marker').forEach(marker => {
      marker.addEventListener('click', () => {
        const key = marker.dataset.location;
        enterLocation(key);
      });
    });

    function enterLocation(key) {
      currentView = key;
      sky.setAttribute('src', locations[key].src);
      document.getElementById('back-btn').style.display = 'block';
      document.getElementById('map-view').setAttribute('visible', false);
      document.getElementById('markers').setAttribute('visible', false);
      alert(`${locations[key].title}\n\n${locations[key].info}`);
    }

    function showMap() {
      currentView = 'map';
      sky.removeAttribute('src');
      sky.setAttribute('color', '#1a1a2e');
      document.getElementById('back-btn').style.display = 'none';
      document.getElementById('map-view').setAttribute('visible', true);
      document.getElementById('markers').setAttribute('visible', true);
    }

    // IMPORTANT: Improved enterVR that checks WebXR support and falls back gracefully.
    async function enterVR() {
      try {
        // If already in VR, do nothing
        if (sceneEl.is('vr-mode')) {
          console.log('Already in VR mode.');
          return;
        }

        // 1) Preferred path: check WebXR support (immersive-vr)
        if (navigator.xr && typeof navigator.xr.isSessionSupported === 'function') {
          try {
            const supported = await navigator.xr.isSessionSupported('immersive-vr');
            console.log('WebXR immersive-vr supported?', supported);
            if (supported) {
              // Let A-Frame handle session creation
              sceneEl.enterVR();
              return;
            }
          } catch (xrErr) {
            console.warn('navigator.xr.isSessionSupported failed:', xrErr);
          }
        }

        // 2) Try A-Frame's enterVR() anyway (this may trigger WebVR fallback in some browsers)
        try {
          sceneEl.enterVR();
          console.log('Called sceneEl.enterVR() fallback.');
          return;
        } catch (afErr) {
          console.warn('sceneEl.enterVR() threw an error:', afErr);
        }

        // 3) Final fallback: request fullscreen "VR-like" view
        const container = sceneEl;
        if (container.requestFullscreen) {
          await container.requestFullscreen();
          alert('Entered fullscreen as a fallback because true VR is not available on this device/browser.');
          return;
        }

        // If we arrive here, nothing worked
        alert('VR is not available on this device or browser. Try:\n‚Ä¢ Chrome on Android or Oculus Browser (HTTPS).\n‚Ä¢ Serve the site over HTTPS or open via http://localhost.\n‚Ä¢ Connect a WebXR headset and retry.');
      } catch (err) {
        console.error('enterVR error:', err);
        alert('An unexpected error occurred while trying to enter VR. Check console for details.');
      }
    }

    // wire the controls
    document.getElementById('enter-vr-btn').addEventListener('click', enterVR);
    document.getElementById('back-btn').addEventListener('click', showMap);
    document.getElementById('info-btn').addEventListener('click', () => {
      if (currentView === 'map') {
        alert('Welcome to Jharkhand VR Tour!\n\nClick red markers to explore tourist destinations.\nUse "Enter VR" for immersive mode.\nIf VR doesn\'t start, read the troubleshooting notes in the console / page.');
      } else {
        const loc = locations[currentView];
        alert(`${loc.title}\n\n${loc.info}`);
      }
    });

    // keyboard shortcuts
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' || e.key.toLowerCase() === 'm') showMap();
      if (e.key.toLowerCase() === 'v') enterVR();
    });

    // helpful console message
    console.log('Scene ready. To test full WebXR: use a WebXR-capable browser + secure context (HTTPS or localhost).');
  </script>
</body>
</html>
